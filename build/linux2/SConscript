#!python
import os

# import these variables from the parent build script
#Import('env', 'sources', 'static_libs', 'test_sources')
Import('env','SRC_PATH','buildroot','include_packages','core_packages','CURRENT_DIR','SDL2_LIB_PATH','SDL2_INCLUDE_PATH','buildroot','targetpath','builddir','lib_packages')

SDL2_LIB_PATH = '/usr/local/lib'
SDL2_INCLUDE_PATH = 'usr/local/include/SDL2'

print("**** Sub Script win32 Config Build")
#print(env)


include_packages.append(CURRENT_DIR + os.sep +'src')
include_packages.append(CURRENT_DIR + os.sep +'vwen')

include_packages.append(CURRENT_DIR + os.sep +'api/include')
include_packages.append(CURRENT_DIR + os.sep +'api/include/glad')
include_packages.append(CURRENT_DIR + os.sep +'api/include/imgui')

core_packages.append('vwen')

lib_packages.append('imgui')
lib_packages.append('glad')
lib_packages.append('SDL2main')
lib_packages.append('SDL2')

#--add list
lib_packages += core_packages
include_packages +=core_packages


#env.Append(LINKFLAGS=['/SUBSYSTEM:CONSOLE']) #work here
#env.Append(LINKFLAGS=['/NODEFAULTLIB:library']) #does not work here

#/NODEFAULTLIB:library
#env.AppendUnique(CXXFLAGS=["/MD","/EHsc"])

#env.Append(LINKFLAGS=['/SUBSYSTEM:CONSOLE']) #SDL2 need this
for basename in core_packages:
	include_packages.append(CURRENT_DIR + os.sep + SRC_PATH + os.sep + basename) #header file basefile.h
	#pass
#print("Include:")
include_packages.append('/user/include/c++/6')
include_packages.append(SDL2_INCLUDE_PATH)
#print(include_packages)
env.Append(CPPPATH=include_packages) #SDL2, Imgui, Gl3w
#build lib file

env.Library(CURRENT_DIR + os.sep + buildroot + os.sep + 'vwen',Glob(CURRENT_DIR + os.sep +'src\\vwen\\*.cpp')) #Gl3w

#--gl
env.Library(CURRENT_DIR + os.sep + buildroot + os.sep + 'glad',Glob(CURRENT_DIR + os.sep +'api\\include\\glad\\*.c')) #Gl3w
#env.Library(CURRENT_DIR + os.sep + buildroot + os.sep + 'gl3w',Glob(CURRENT_DIR + os.sep +'api\\gl3w\\GL\\*.c')) #Gl3w
#env.Library(CURRENT_DIR + os.sep + buildroot + os.sep + 'glfw3',CURRENT_DIR + os.sep + "api\\glfw\\lib-vs2015\\glfw3dll.lib") #glfw3

env.Library(CURRENT_DIR + os.sep + buildroot + os.sep + 'imgui',Glob(CURRENT_DIR + os.sep + "api\\include\\imgui\\*.cpp")) #imgui
#--sdl2
#env.Library(buildroot + os.sep + 'SDL2',Glob("C:\\SDL2-2.0.5\\lib\\x86\\*.lib")) #
#env.Library(buildroot + os.sep + 'SDL2', "C:\\SDL2-2.0.5\\lib\\x86\\SDL2.lib") #
#env.Library(buildroot + os.sep + 'SDL2main',"C:\\SDL2-2.0.5\\lib\\x86\\SDL2main.lib") #
#env.Library(buildroot + os.sep + 'SDL2test',"C:\\SDL2-2.0.5\\lib\\x86\\SDL2test.lib") #

for basename in core_packages:
	env.Library(CURRENT_DIR + os.sep + buildroot + os.sep + basename, Glob(CURRENT_DIR + os.sep + SRC_PATH + os.sep + basename + os.sep + '*.cpp')) #core nodes
	#pass
#print(core_packages)
#--SDL2
env.Install(CURRENT_DIR + os.sep + buildroot,"/usr/local/lib/libSDL2.so") #copy dll to output bin
#--glfw3
#env.Install(CURRENT_DIR + os.sep + buildroot,CURRENT_DIR + os.sep + "api\\glfw\\lib-vs2015\\glfw3.dll") #copy dll to output bin

#print("LIBS:")
#print(lib_packages)
#print("Bin:")
#print(buildroot)
#print("Main:",builddir + os.sep + '*.cpp')